{"ast":null,"code":"import _classCallCheck from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _callSuper from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/callSuper.js\";\nimport _inherits from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _defineProperty from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.date.now.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.find.js\";\nimport { ParentBlot } from 'parchment';\nimport Module from '../core/module.js';\nimport Quill from '../core/quill.js';\nvar isMac = /Mac/i.test(navigator.platform);\n\n// Export for testing\nexport var TTL_FOR_VALID_SELECTION_CHANGE = 100;\n\n// A loose check to determine if the shortcut can move the caret before a UI node:\n// <ANY_PARENT>[CARET]<div class=\"ql-ui\"></div>[CONTENT]</ANY_PARENT>\nvar canMoveCaretBeforeUINode = function canMoveCaretBeforeUINode(event) {\n  if (event.key === 'ArrowLeft' || event.key === 'ArrowRight' ||\n  // RTL scripts or moving from the end of the previous line\n  event.key === 'ArrowUp' || event.key === 'ArrowDown' || event.key === 'Home') {\n    return true;\n  }\n  if (isMac && event.key === 'a' && event.ctrlKey === true) {\n    return true;\n  }\n  return false;\n};\nvar UINode = /*#__PURE__*/function (_Module) {\n  function UINode(quill, options) {\n    var _this;\n    _classCallCheck(this, UINode);\n    _this = _callSuper(this, UINode, [quill, options]);\n    _defineProperty(_this, \"isListening\", false);\n    _defineProperty(_this, \"selectionChangeDeadline\", 0);\n    _this.handleArrowKeys();\n    _this.handleNavigationShortcuts();\n    return _this;\n  }\n  _inherits(UINode, _Module);\n  return _createClass(UINode, [{\n    key: \"handleArrowKeys\",\n    value: function handleArrowKeys() {\n      this.quill.keyboard.addBinding({\n        key: ['ArrowLeft', 'ArrowRight'],\n        offset: 0,\n        shiftKey: null,\n        handler: function handler(range, _ref) {\n          var line = _ref.line,\n            event = _ref.event;\n          if (!(line instanceof ParentBlot) || !line.uiNode) {\n            return true;\n          }\n          var isRTL = getComputedStyle(line.domNode)['direction'] === 'rtl';\n          if (isRTL && event.key !== 'ArrowRight' || !isRTL && event.key !== 'ArrowLeft') {\n            return true;\n          }\n          this.quill.setSelection(range.index - 1, range.length + (event.shiftKey ? 1 : 0), Quill.sources.USER);\n          return false;\n        }\n      });\n    }\n  }, {\n    key: \"handleNavigationShortcuts\",\n    value: function handleNavigationShortcuts() {\n      var _this2 = this;\n      this.quill.root.addEventListener('keydown', function (event) {\n        if (!event.defaultPrevented && canMoveCaretBeforeUINode(event)) {\n          _this2.ensureListeningToSelectionChange();\n        }\n      });\n    }\n\n    /**\n     * We only listen to the `selectionchange` event when\n     * there is an intention of moving the caret to the beginning using shortcuts.\n     * This is primarily implemented to prevent infinite loops, as we are changing\n     * the selection within the handler of a `selectionchange` event.\n     */\n  }, {\n    key: \"ensureListeningToSelectionChange\",\n    value: function ensureListeningToSelectionChange() {\n      var _this3 = this;\n      this.selectionChangeDeadline = Date.now() + TTL_FOR_VALID_SELECTION_CHANGE;\n      if (this.isListening) return;\n      this.isListening = true;\n      var listener = function listener() {\n        _this3.isListening = false;\n        if (Date.now() <= _this3.selectionChangeDeadline) {\n          _this3.handleSelectionChange();\n        }\n      };\n      document.addEventListener('selectionchange', listener, {\n        once: true\n      });\n    }\n  }, {\n    key: \"handleSelectionChange\",\n    value: function handleSelectionChange() {\n      var selection = document.getSelection();\n      if (!selection) return;\n      var range = selection.getRangeAt(0);\n      if (range.collapsed !== true || range.startOffset !== 0) return;\n      var line = this.quill.scroll.find(range.startContainer);\n      if (!(line instanceof ParentBlot) || !line.uiNode) return;\n      var newRange = document.createRange();\n      newRange.setStartAfter(line.uiNode);\n      newRange.setEndAfter(line.uiNode);\n      selection.removeAllRanges();\n      selection.addRange(newRange);\n    }\n  }]);\n}(Module);\nexport default UINode;","map":{"version":3,"names":["ParentBlot","Module","Quill","isMac","test","navigator","platform","TTL_FOR_VALID_SELECTION_CHANGE","canMoveCaretBeforeUINode","event","key","ctrlKey","UINode","_Module","quill","options","_this","_classCallCheck","_callSuper","_defineProperty","handleArrowKeys","handleNavigationShortcuts","_inherits","_createClass","value","keyboard","addBinding","offset","shiftKey","handler","range","_ref","line","uiNode","isRTL","getComputedStyle","domNode","setSelection","index","length","sources","USER","_this2","root","addEventListener","defaultPrevented","ensureListeningToSelectionChange","_this3","selectionChangeDeadline","Date","now","isListening","listener","handleSelectionChange","document","once","selection","getSelection","getRangeAt","collapsed","startOffset","scroll","find","startContainer","newRange","createRange","setStartAfter","setEndAfter","removeAllRanges","addRange"],"sources":["../../src/modules/uiNode.ts"],"sourcesContent":["import { ParentBlot } from 'parchment';\nimport Module from '../core/module.js';\nimport Quill from '../core/quill.js';\n\nconst isMac = /Mac/i.test(navigator.platform);\n\n// Export for testing\nexport const TTL_FOR_VALID_SELECTION_CHANGE = 100;\n\n// A loose check to determine if the shortcut can move the caret before a UI node:\n// <ANY_PARENT>[CARET]<div class=\"ql-ui\"></div>[CONTENT]</ANY_PARENT>\nconst canMoveCaretBeforeUINode = (event: KeyboardEvent) => {\n  if (\n    event.key === 'ArrowLeft' ||\n    event.key === 'ArrowRight' || // RTL scripts or moving from the end of the previous line\n    event.key === 'ArrowUp' ||\n    event.key === 'ArrowDown' ||\n    event.key === 'Home'\n  ) {\n    return true;\n  }\n\n  if (isMac && event.key === 'a' && event.ctrlKey === true) {\n    return true;\n  }\n\n  return false;\n};\n\nclass UINode extends Module {\n  isListening = false;\n  selectionChangeDeadline = 0;\n\n  constructor(quill: Quill, options: Record<string, never>) {\n    super(quill, options);\n\n    this.handleArrowKeys();\n    this.handleNavigationShortcuts();\n  }\n\n  private handleArrowKeys() {\n    this.quill.keyboard.addBinding({\n      key: ['ArrowLeft', 'ArrowRight'],\n      offset: 0,\n      shiftKey: null,\n      handler(range, { line, event }) {\n        if (!(line instanceof ParentBlot) || !line.uiNode) {\n          return true;\n        }\n\n        const isRTL = getComputedStyle(line.domNode)['direction'] === 'rtl';\n        if (\n          (isRTL && event.key !== 'ArrowRight') ||\n          (!isRTL && event.key !== 'ArrowLeft')\n        ) {\n          return true;\n        }\n\n        this.quill.setSelection(\n          range.index - 1,\n          range.length + (event.shiftKey ? 1 : 0),\n          Quill.sources.USER,\n        );\n        return false;\n      },\n    });\n  }\n\n  private handleNavigationShortcuts() {\n    this.quill.root.addEventListener('keydown', (event) => {\n      if (!event.defaultPrevented && canMoveCaretBeforeUINode(event)) {\n        this.ensureListeningToSelectionChange();\n      }\n    });\n  }\n\n  /**\n   * We only listen to the `selectionchange` event when\n   * there is an intention of moving the caret to the beginning using shortcuts.\n   * This is primarily implemented to prevent infinite loops, as we are changing\n   * the selection within the handler of a `selectionchange` event.\n   */\n  private ensureListeningToSelectionChange() {\n    this.selectionChangeDeadline = Date.now() + TTL_FOR_VALID_SELECTION_CHANGE;\n\n    if (this.isListening) return;\n    this.isListening = true;\n\n    const listener = () => {\n      this.isListening = false;\n\n      if (Date.now() <= this.selectionChangeDeadline) {\n        this.handleSelectionChange();\n      }\n    };\n\n    document.addEventListener('selectionchange', listener, {\n      once: true,\n    });\n  }\n\n  private handleSelectionChange() {\n    const selection = document.getSelection();\n    if (!selection) return;\n    const range = selection.getRangeAt(0);\n    if (range.collapsed !== true || range.startOffset !== 0) return;\n\n    const line = this.quill.scroll.find(range.startContainer);\n    if (!(line instanceof ParentBlot) || !line.uiNode) return;\n\n    const newRange = document.createRange();\n    newRange.setStartAfter(line.uiNode);\n    newRange.setEndAfter(line.uiNode);\n    selection.removeAllRanges();\n    selection.addRange(newRange);\n  }\n}\n\nexport default UINode;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}