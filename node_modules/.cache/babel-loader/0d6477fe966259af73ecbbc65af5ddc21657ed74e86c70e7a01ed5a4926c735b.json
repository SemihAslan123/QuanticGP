{"ast":null,"code":"import _classCallCheck from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _callSuper from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/callSuper.js\";\nimport _inherits from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.array.from.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.reduce.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/esnext.iterator.map.js\";\nimport \"core-js/modules/esnext.iterator.reduce.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport Delta from 'quill-delta';\nimport Emitter from '../core/emitter.js';\nimport Module from '../core/module.js';\nvar Uploader = /*#__PURE__*/function (_Module) {\n  function Uploader(quill, options) {\n    var _this;\n    _classCallCheck(this, Uploader);\n    _this = _callSuper(this, Uploader, [quill, options]);\n    quill.root.addEventListener('drop', function (e) {\n      e.preventDefault();\n      var _native = null;\n      if (document.caretRangeFromPoint) {\n        _native = document.caretRangeFromPoint(e.clientX, e.clientY);\n        // @ts-expect-error\n      } else if (document.caretPositionFromPoint) {\n        // @ts-expect-error\n        var position = document.caretPositionFromPoint(e.clientX, e.clientY);\n        _native = document.createRange();\n        _native.setStart(position.offsetNode, position.offset);\n        _native.setEnd(position.offsetNode, position.offset);\n      }\n      var normalized = _native && quill.selection.normalizeNative(_native);\n      if (normalized) {\n        var _e$dataTransfer;\n        var range = quill.selection.normalizedToRange(normalized);\n        if ((_e$dataTransfer = e.dataTransfer) !== null && _e$dataTransfer !== void 0 && _e$dataTransfer.files) {\n          _this.upload(range, e.dataTransfer.files);\n        }\n      }\n    });\n    return _this;\n  }\n  _inherits(Uploader, _Module);\n  return _createClass(Uploader, [{\n    key: \"upload\",\n    value: function upload(range, files) {\n      var _this2 = this;\n      var uploads = [];\n      Array.from(files).forEach(function (file) {\n        var _this2$options$mimety;\n        if (file && (_this2$options$mimety = _this2.options.mimetypes) !== null && _this2$options$mimety !== void 0 && _this2$options$mimety.includes(file.type)) {\n          uploads.push(file);\n        }\n      });\n      if (uploads.length > 0) {\n        // @ts-expect-error Fix me later\n        this.options.handler.call(this, range, uploads);\n      }\n    }\n  }]);\n}(Module);\nUploader.DEFAULTS = {\n  mimetypes: ['image/png', 'image/jpeg'],\n  handler: function handler(range, files) {\n    var _this3 = this;\n    if (!this.quill.scroll.query('image')) {\n      return;\n    }\n    var promises = files.map(function (file) {\n      return new Promise(function (resolve) {\n        var reader = new FileReader();\n        reader.onload = function () {\n          resolve(reader.result);\n        };\n        reader.readAsDataURL(file);\n      });\n    });\n    Promise.all(promises).then(function (images) {\n      var update = images.reduce(function (delta, image) {\n        return delta.insert({\n          image: image\n        });\n      }, new Delta().retain(range.index)[\"delete\"](range.length));\n      _this3.quill.updateContents(update, Emitter.sources.USER);\n      _this3.quill.setSelection(range.index + images.length, Emitter.sources.SILENT);\n    });\n  }\n};\nexport default Uploader;","map":{"version":3,"names":["Delta","Emitter","Module","Uploader","_Module","quill","options","_this","_classCallCheck","_callSuper","root","addEventListener","e","preventDefault","native","document","caretRangeFromPoint","clientX","clientY","caretPositionFromPoint","position","createRange","setStart","offsetNode","offset","setEnd","normalized","selection","normalizeNative","_e$dataTransfer","range","normalizedToRange","dataTransfer","files","upload","_inherits","_createClass","key","value","_this2","uploads","Array","from","forEach","file","_this2$options$mimety","mimetypes","includes","type","push","length","handler","call","DEFAULTS","_this3","scroll","query","promises","map","Promise","resolve","reader","FileReader","onload","result","readAsDataURL","all","then","images","update","reduce","delta","image","insert","retain","index","updateContents","sources","USER","setSelection","SILENT"],"sources":["../../src/modules/uploader.ts"],"sourcesContent":["import Delta from 'quill-delta';\nimport type Quill from '../core/quill.js';\nimport Emitter from '../core/emitter.js';\nimport Module from '../core/module.js';\nimport type { Range } from '../core/selection.js';\n\ninterface UploaderOptions {\n  mimetypes: string[];\n  handler: (this: { quill: Quill }, range: Range, files: File[]) => void;\n}\n\nclass Uploader extends Module<UploaderOptions> {\n  static DEFAULTS: UploaderOptions;\n\n  constructor(quill: Quill, options: Partial<UploaderOptions>) {\n    super(quill, options);\n    quill.root.addEventListener('drop', (e) => {\n      e.preventDefault();\n      let native: ReturnType<typeof document.createRange> | null = null;\n      if (document.caretRangeFromPoint) {\n        native = document.caretRangeFromPoint(e.clientX, e.clientY);\n        // @ts-expect-error\n      } else if (document.caretPositionFromPoint) {\n        // @ts-expect-error\n        const position = document.caretPositionFromPoint(e.clientX, e.clientY);\n        native = document.createRange();\n        native.setStart(position.offsetNode, position.offset);\n        native.setEnd(position.offsetNode, position.offset);\n      }\n\n      const normalized = native && quill.selection.normalizeNative(native);\n      if (normalized) {\n        const range = quill.selection.normalizedToRange(normalized);\n        if (e.dataTransfer?.files) {\n          this.upload(range, e.dataTransfer.files);\n        }\n      }\n    });\n  }\n\n  upload(range: Range, files: FileList | File[]) {\n    const uploads: File[] = [];\n    Array.from(files).forEach((file) => {\n      if (file && this.options.mimetypes?.includes(file.type)) {\n        uploads.push(file);\n      }\n    });\n    if (uploads.length > 0) {\n      // @ts-expect-error Fix me later\n      this.options.handler.call(this, range, uploads);\n    }\n  }\n}\n\nUploader.DEFAULTS = {\n  mimetypes: ['image/png', 'image/jpeg'],\n  handler(range: Range, files: File[]) {\n    if (!this.quill.scroll.query('image')) {\n      return;\n    }\n    const promises = files.map<Promise<string>>((file) => {\n      return new Promise((resolve) => {\n        const reader = new FileReader();\n        reader.onload = () => {\n          resolve(reader.result as string);\n        };\n        reader.readAsDataURL(file);\n      });\n    });\n    Promise.all(promises).then((images) => {\n      const update = images.reduce((delta: Delta, image) => {\n        return delta.insert({ image });\n      }, new Delta().retain(range.index).delete(range.length)) as Delta;\n      this.quill.updateContents(update, Emitter.sources.USER);\n      this.quill.setSelection(\n        range.index + images.length,\n        Emitter.sources.SILENT,\n      );\n    });\n  },\n};\n\nexport default Uploader;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}