{"ast":null,"code":"import _classCallCheck from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _callSuper from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/callSuper.js\";\nimport _inherits from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _defineProperty from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.reduce.js\";\nimport \"core-js/modules/es.array.some.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.date.now.js\";\nimport \"core-js/modules/es.function.bind.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"core-js/modules/es.string.ends-with.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.reduce.js\";\nimport \"core-js/modules/esnext.iterator.some.js\";\nimport { Scope } from 'parchment';\nimport Module from '../core/module.js';\nimport Quill from '../core/quill.js';\nvar History = /*#__PURE__*/function (_Module) {\n  function History(quill, options) {\n    var _this;\n    _classCallCheck(this, History);\n    _this = _callSuper(this, History, [quill, options]);\n    _defineProperty(_this, \"lastRecorded\", 0);\n    _defineProperty(_this, \"ignoreChange\", false);\n    _defineProperty(_this, \"stack\", {\n      undo: [],\n      redo: []\n    });\n    _defineProperty(_this, \"currentRange\", null);\n    _this.quill.on(Quill.events.EDITOR_CHANGE, function (eventName, value, oldValue, source) {\n      if (eventName === Quill.events.SELECTION_CHANGE) {\n        if (value && source !== Quill.sources.SILENT) {\n          _this.currentRange = value;\n        }\n      } else if (eventName === Quill.events.TEXT_CHANGE) {\n        if (!_this.ignoreChange) {\n          if (!_this.options.userOnly || source === Quill.sources.USER) {\n            _this.record(value, oldValue);\n          } else {\n            _this.transform(value);\n          }\n        }\n        _this.currentRange = transformRange(_this.currentRange, value);\n      }\n    });\n    _this.quill.keyboard.addBinding({\n      key: 'z',\n      shortKey: true\n    }, _this.undo.bind(_this));\n    _this.quill.keyboard.addBinding({\n      key: ['z', 'Z'],\n      shortKey: true,\n      shiftKey: true\n    }, _this.redo.bind(_this));\n    if (/Win/i.test(navigator.platform)) {\n      _this.quill.keyboard.addBinding({\n        key: 'y',\n        shortKey: true\n      }, _this.redo.bind(_this));\n    }\n    _this.quill.root.addEventListener('beforeinput', function (event) {\n      if (event.inputType === 'historyUndo') {\n        _this.undo();\n        event.preventDefault();\n      } else if (event.inputType === 'historyRedo') {\n        _this.redo();\n        event.preventDefault();\n      }\n    });\n    return _this;\n  }\n  _inherits(History, _Module);\n  return _createClass(History, [{\n    key: \"change\",\n    value: function change(source, dest) {\n      if (this.stack[source].length === 0) return;\n      var item = this.stack[source].pop();\n      if (!item) return;\n      var base = this.quill.getContents();\n      var inverseDelta = item.delta.invert(base);\n      this.stack[dest].push({\n        delta: inverseDelta,\n        range: transformRange(item.range, inverseDelta)\n      });\n      this.lastRecorded = 0;\n      this.ignoreChange = true;\n      this.quill.updateContents(item.delta, Quill.sources.USER);\n      this.ignoreChange = false;\n      this.restoreSelection(item);\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.stack = {\n        undo: [],\n        redo: []\n      };\n    }\n  }, {\n    key: \"cutoff\",\n    value: function cutoff() {\n      this.lastRecorded = 0;\n    }\n  }, {\n    key: \"record\",\n    value: function record(changeDelta, oldDelta) {\n      if (changeDelta.ops.length === 0) return;\n      this.stack.redo = [];\n      var undoDelta = changeDelta.invert(oldDelta);\n      var undoRange = this.currentRange;\n      var timestamp = Date.now();\n      if (\n      // @ts-expect-error Fix me later\n      this.lastRecorded + this.options.delay > timestamp && this.stack.undo.length > 0) {\n        var item = this.stack.undo.pop();\n        if (item) {\n          undoDelta = undoDelta.compose(item.delta);\n          undoRange = item.range;\n        }\n      } else {\n        this.lastRecorded = timestamp;\n      }\n      if (undoDelta.length() === 0) return;\n      this.stack.undo.push({\n        delta: undoDelta,\n        range: undoRange\n      });\n      // @ts-expect-error Fix me later\n      if (this.stack.undo.length > this.options.maxStack) {\n        this.stack.undo.shift();\n      }\n    }\n  }, {\n    key: \"redo\",\n    value: function redo() {\n      this.change('redo', 'undo');\n    }\n  }, {\n    key: \"transform\",\n    value: function transform(delta) {\n      transformStack(this.stack.undo, delta);\n      transformStack(this.stack.redo, delta);\n    }\n  }, {\n    key: \"undo\",\n    value: function undo() {\n      this.change('undo', 'redo');\n    }\n  }, {\n    key: \"restoreSelection\",\n    value: function restoreSelection(stackItem) {\n      if (stackItem.range) {\n        this.quill.setSelection(stackItem.range, Quill.sources.USER);\n      } else {\n        var index = getLastChangeIndex(this.quill.scroll, stackItem.delta);\n        this.quill.setSelection(index, Quill.sources.USER);\n      }\n    }\n  }]);\n}(Module);\n_defineProperty(History, \"DEFAULTS\", {\n  delay: 1000,\n  maxStack: 100,\n  userOnly: false\n});\nfunction transformStack(stack, delta) {\n  var remoteDelta = delta;\n  for (var i = stack.length - 1; i >= 0; i -= 1) {\n    var oldItem = stack[i];\n    stack[i] = {\n      delta: remoteDelta.transform(oldItem.delta, true),\n      range: oldItem.range && transformRange(oldItem.range, remoteDelta)\n    };\n    remoteDelta = oldItem.delta.transform(remoteDelta);\n    if (stack[i].delta.length() === 0) {\n      stack.splice(i, 1);\n    }\n  }\n}\nfunction endsWithNewlineChange(scroll, delta) {\n  var lastOp = delta.ops[delta.ops.length - 1];\n  if (lastOp == null) return false;\n  if (lastOp.insert != null) {\n    return typeof lastOp.insert === 'string' && lastOp.insert.endsWith('\\n');\n  }\n  if (lastOp.attributes != null) {\n    return Object.keys(lastOp.attributes).some(function (attr) {\n      return scroll.query(attr, Scope.BLOCK) != null;\n    });\n  }\n  return false;\n}\nfunction getLastChangeIndex(scroll, delta) {\n  var deleteLength = delta.reduce(function (length, op) {\n    return length + (op[\"delete\"] || 0);\n  }, 0);\n  var changeIndex = delta.length() - deleteLength;\n  if (endsWithNewlineChange(scroll, delta)) {\n    changeIndex -= 1;\n  }\n  return changeIndex;\n}\nfunction transformRange(range, delta) {\n  if (!range) return range;\n  var start = delta.transformPosition(range.index);\n  var end = delta.transformPosition(range.index + range.length);\n  return {\n    index: start,\n    length: end - start\n  };\n}\nexport { History as default, getLastChangeIndex };","map":{"version":3,"names":["Scope","Module","Quill","History","_Module","quill","options","_this","_classCallCheck","_callSuper","_defineProperty","undo","redo","on","events","EDITOR_CHANGE","eventName","value","oldValue","source","SELECTION_CHANGE","sources","SILENT","currentRange","TEXT_CHANGE","ignoreChange","userOnly","USER","record","transform","transformRange","keyboard","addBinding","key","shortKey","bind","shiftKey","test","navigator","platform","root","addEventListener","event","inputType","preventDefault","_inherits","_createClass","change","dest","stack","length","item","pop","base","getContents","inverseDelta","delta","invert","push","range","lastRecorded","updateContents","restoreSelection","clear","cutoff","changeDelta","oldDelta","ops","undoDelta","undoRange","timestamp","Date","now","delay","compose","maxStack","shift","transformStack","stackItem","setSelection","index","getLastChangeIndex","scroll","remoteDelta","i","oldItem","splice","endsWithNewlineChange","lastOp","insert","endsWith","attributes","Object","keys","some","attr","query","BLOCK","deleteLength","reduce","op","changeIndex","start","transformPosition","end","default"],"sources":["../../src/modules/history.ts"],"sourcesContent":["import { Scope } from 'parchment';\nimport type Delta from 'quill-delta';\nimport Module from '../core/module.js';\nimport Quill from '../core/quill.js';\nimport type Scroll from '../blots/scroll.js';\nimport type { Range } from '../core/selection.js';\n\nexport interface HistoryOptions {\n  userOnly: boolean;\n  delay: number;\n  maxStack: number;\n}\n\nexport interface StackItem {\n  delta: Delta;\n  range: Range | null;\n}\n\ninterface Stack {\n  undo: StackItem[];\n  redo: StackItem[];\n}\n\nclass History extends Module<HistoryOptions> {\n  static DEFAULTS: HistoryOptions = {\n    delay: 1000,\n    maxStack: 100,\n    userOnly: false,\n  };\n\n  lastRecorded = 0;\n  ignoreChange = false;\n  stack: Stack = { undo: [], redo: [] };\n  currentRange: Range | null = null;\n\n  constructor(quill: Quill, options: Partial<HistoryOptions>) {\n    super(quill, options);\n    this.quill.on(\n      Quill.events.EDITOR_CHANGE,\n      (eventName, value, oldValue, source) => {\n        if (eventName === Quill.events.SELECTION_CHANGE) {\n          if (value && source !== Quill.sources.SILENT) {\n            this.currentRange = value;\n          }\n        } else if (eventName === Quill.events.TEXT_CHANGE) {\n          if (!this.ignoreChange) {\n            if (!this.options.userOnly || source === Quill.sources.USER) {\n              this.record(value, oldValue);\n            } else {\n              this.transform(value);\n            }\n          }\n\n          this.currentRange = transformRange(this.currentRange, value);\n        }\n      },\n    );\n\n    this.quill.keyboard.addBinding(\n      { key: 'z', shortKey: true },\n      this.undo.bind(this),\n    );\n    this.quill.keyboard.addBinding(\n      { key: ['z', 'Z'], shortKey: true, shiftKey: true },\n      this.redo.bind(this),\n    );\n    if (/Win/i.test(navigator.platform)) {\n      this.quill.keyboard.addBinding(\n        { key: 'y', shortKey: true },\n        this.redo.bind(this),\n      );\n    }\n\n    this.quill.root.addEventListener('beforeinput', (event) => {\n      if (event.inputType === 'historyUndo') {\n        this.undo();\n        event.preventDefault();\n      } else if (event.inputType === 'historyRedo') {\n        this.redo();\n        event.preventDefault();\n      }\n    });\n  }\n\n  change(source: 'undo' | 'redo', dest: 'redo' | 'undo') {\n    if (this.stack[source].length === 0) return;\n    const item = this.stack[source].pop();\n    if (!item) return;\n    const base = this.quill.getContents();\n    const inverseDelta = item.delta.invert(base);\n    this.stack[dest].push({\n      delta: inverseDelta,\n      range: transformRange(item.range, inverseDelta),\n    });\n    this.lastRecorded = 0;\n    this.ignoreChange = true;\n    this.quill.updateContents(item.delta, Quill.sources.USER);\n    this.ignoreChange = false;\n\n    this.restoreSelection(item);\n  }\n\n  clear() {\n    this.stack = { undo: [], redo: [] };\n  }\n\n  cutoff() {\n    this.lastRecorded = 0;\n  }\n\n  record(changeDelta: Delta, oldDelta: Delta) {\n    if (changeDelta.ops.length === 0) return;\n    this.stack.redo = [];\n    let undoDelta = changeDelta.invert(oldDelta);\n    let undoRange = this.currentRange;\n    const timestamp = Date.now();\n    if (\n      // @ts-expect-error Fix me later\n      this.lastRecorded + this.options.delay > timestamp &&\n      this.stack.undo.length > 0\n    ) {\n      const item = this.stack.undo.pop();\n      if (item) {\n        undoDelta = undoDelta.compose(item.delta);\n        undoRange = item.range;\n      }\n    } else {\n      this.lastRecorded = timestamp;\n    }\n    if (undoDelta.length() === 0) return;\n    this.stack.undo.push({ delta: undoDelta, range: undoRange });\n    // @ts-expect-error Fix me later\n    if (this.stack.undo.length > this.options.maxStack) {\n      this.stack.undo.shift();\n    }\n  }\n\n  redo() {\n    this.change('redo', 'undo');\n  }\n\n  transform(delta: Delta) {\n    transformStack(this.stack.undo, delta);\n    transformStack(this.stack.redo, delta);\n  }\n\n  undo() {\n    this.change('undo', 'redo');\n  }\n\n  protected restoreSelection(stackItem: StackItem) {\n    if (stackItem.range) {\n      this.quill.setSelection(stackItem.range, Quill.sources.USER);\n    } else {\n      const index = getLastChangeIndex(this.quill.scroll, stackItem.delta);\n      this.quill.setSelection(index, Quill.sources.USER);\n    }\n  }\n}\n\nfunction transformStack(stack: StackItem[], delta: Delta) {\n  let remoteDelta = delta;\n  for (let i = stack.length - 1; i >= 0; i -= 1) {\n    const oldItem = stack[i];\n    stack[i] = {\n      delta: remoteDelta.transform(oldItem.delta, true),\n      range: oldItem.range && transformRange(oldItem.range, remoteDelta),\n    };\n    remoteDelta = oldItem.delta.transform(remoteDelta);\n    if (stack[i].delta.length() === 0) {\n      stack.splice(i, 1);\n    }\n  }\n}\n\nfunction endsWithNewlineChange(scroll: Scroll, delta: Delta) {\n  const lastOp = delta.ops[delta.ops.length - 1];\n  if (lastOp == null) return false;\n  if (lastOp.insert != null) {\n    return typeof lastOp.insert === 'string' && lastOp.insert.endsWith('\\n');\n  }\n  if (lastOp.attributes != null) {\n    return Object.keys(lastOp.attributes).some((attr) => {\n      return scroll.query(attr, Scope.BLOCK) != null;\n    });\n  }\n  return false;\n}\n\nfunction getLastChangeIndex(scroll: Scroll, delta: Delta) {\n  const deleteLength = delta.reduce((length, op) => {\n    return length + (op.delete || 0);\n  }, 0);\n  let changeIndex = delta.length() - deleteLength;\n  if (endsWithNewlineChange(scroll, delta)) {\n    changeIndex -= 1;\n  }\n  return changeIndex;\n}\n\nfunction transformRange(range: Range | null, delta: Delta) {\n  if (!range) return range;\n  const start = delta.transformPosition(range.index);\n  const end = delta.transformPosition(range.index + range.length);\n  return { index: start, length: end - start };\n}\n\nexport { History as default, getLastChangeIndex };\n"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,SAASA,KAAK,QAAQ,WAAW;AAEjC,OAAOC,MAAM,MAAM,mBAAmB;AACtC,OAAOC,KAAK,MAAM,kBAAkB;AAAA,IAoB9BC,OAAO,0BAAAC,OAAA;EAYX,SAAAD,QAAYE,KAAY,EAAEC,OAAgC,EAAE;IAAA,IAAAC,KAAA;IAAAC,eAAA,OAAAL,OAAA;IAC1DI,KAAA,GAAAE,UAAA,OAAAN,OAAA,GAAME,KAAK,EAAEC,OAAO;IAACI,eAAA,CAAAH,KAAA,kBANR,CAAC;IAAAG,eAAA,CAAAH,KAAA,kBACD,KAAK;IAAAG,eAAA,CAAAH,KAAA,WACL;MAAEI,IAAI,EAAE,EAAE;MAAEC,IAAI,EAAE;IAAG,CAAC;IAAAF,eAAA,CAAAH,KAAA,kBACR,IAAI;IAI/BA,KAAA,CAAKF,KAAK,CAACQ,EAAE,CACXX,KAAK,CAACY,MAAM,CAACC,aAAa,EAC1B,UAACC,SAAS,EAAEC,KAAK,EAAEC,QAAQ,EAAEC,MAAM,EAAK;MACtC,IAAIH,SAAS,KAAKd,KAAK,CAACY,MAAM,CAACM,gBAAgB,EAAE;QAC/C,IAAIH,KAAK,IAAIE,MAAM,KAAKjB,KAAK,CAACmB,OAAO,CAACC,MAAM,EAAE;UAC5Cf,KAAA,CAAKgB,YAAY,GAAGN,KAAK;QAC3B;MACF,CAAC,MAAM,IAAID,SAAS,KAAKd,KAAK,CAACY,MAAM,CAACU,WAAW,EAAE;QACjD,IAAI,CAACjB,KAAA,CAAKkB,YAAY,EAAE;UACtB,IAAI,CAAClB,KAAA,CAAKD,OAAO,CAACoB,QAAQ,IAAIP,MAAM,KAAKjB,KAAK,CAACmB,OAAO,CAACM,IAAI,EAAE;YAC3DpB,KAAA,CAAKqB,MAAM,CAACX,KAAK,EAAEC,QAAQ,CAAC;UAC9B,CAAC,MAAM;YACLX,KAAA,CAAKsB,SAAS,CAACZ,KAAK,CAAC;UACvB;QACF;QAEAV,KAAA,CAAKgB,YAAY,GAAGO,cAAc,CAACvB,KAAA,CAAKgB,YAAY,EAAEN,KAAK,CAAC;MAC9D;IACF,CACF,CAAC;IAEDV,KAAA,CAAKF,KAAK,CAAC0B,QAAQ,CAACC,UAAU,CAC5B;MAAEC,GAAG,EAAE,GAAG;MAAEC,QAAQ,EAAE;IAAK,CAAC,EAC5B3B,KAAA,CAAKI,IAAI,CAACwB,IAAI,CAAA5B,KAAK,CACrB,CAAC;IACDA,KAAA,CAAKF,KAAK,CAAC0B,QAAQ,CAACC,UAAU,CAC5B;MAAEC,GAAG,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC;MAAEC,QAAQ,EAAE,IAAI;MAAEE,QAAQ,EAAE;IAAK,CAAC,EACnD7B,KAAA,CAAKK,IAAI,CAACuB,IAAI,CAAA5B,KAAK,CACrB,CAAC;IACD,IAAI,MAAM,CAAC8B,IAAI,CAACC,SAAS,CAACC,QAAQ,CAAC,EAAE;MACnChC,KAAA,CAAKF,KAAK,CAAC0B,QAAQ,CAACC,UAAU,CAC5B;QAAEC,GAAG,EAAE,GAAG;QAAEC,QAAQ,EAAE;MAAK,CAAC,EAC5B3B,KAAA,CAAKK,IAAI,CAACuB,IAAI,CAAA5B,KAAK,CACrB,CAAC;IACH;IAEAA,KAAA,CAAKF,KAAK,CAACmC,IAAI,CAACC,gBAAgB,CAAC,aAAa,EAAG,UAAAC,KAAK,EAAK;MACzD,IAAIA,KAAK,CAACC,SAAS,KAAK,aAAa,EAAE;QACrCpC,KAAA,CAAKI,IAAI,CAAC,CAAC;QACX+B,KAAK,CAACE,cAAc,CAAC,CAAC;MACxB,CAAC,MAAM,IAAIF,KAAK,CAACC,SAAS,KAAK,aAAa,EAAE;QAC5CpC,KAAA,CAAKK,IAAI,CAAC,CAAC;QACX8B,KAAK,CAACE,cAAc,CAAC,CAAC;MACxB;IACF,CAAC,CAAC;IAAA,OAAArC,KAAA;EACJ;EAAAsC,SAAA,CAAA1C,OAAA,EAAAC,OAAA;EAAA,OAAA0C,YAAA,CAAA3C,OAAA;IAAA8B,GAAA;IAAAhB,KAAA,EAEA,SAAA8B,MAAMA,CAAC5B,MAAuB,EAAE6B,IAAqB,EAAE;MACrD,IAAI,IAAI,CAACC,KAAK,CAAC9B,MAAM,CAAC,CAAC+B,MAAM,KAAK,CAAC,EAAE;MACrC,IAAMC,IAAI,GAAG,IAAI,CAACF,KAAK,CAAC9B,MAAM,CAAC,CAACiC,GAAG,CAAC,CAAC;MACrC,IAAI,CAACD,IAAI,EAAE;MACX,IAAME,IAAI,GAAG,IAAI,CAAChD,KAAK,CAACiD,WAAW,CAAC,CAAC;MACrC,IAAMC,YAAY,GAAGJ,IAAI,CAACK,KAAK,CAACC,MAAM,CAACJ,IAAI,CAAC;MAC5C,IAAI,CAACJ,KAAK,CAACD,IAAI,CAAC,CAACU,IAAI,CAAC;QACpBF,KAAK,EAAED,YAAY;QACnBI,KAAK,EAAE7B,cAAc,CAACqB,IAAI,CAACQ,KAAK,EAAEJ,YAAY;MAChD,CAAC,CAAC;MACF,IAAI,CAACK,YAAY,GAAG,CAAC;MACrB,IAAI,CAACnC,YAAY,GAAG,IAAI;MACxB,IAAI,CAACpB,KAAK,CAACwD,cAAc,CAACV,IAAI,CAACK,KAAK,EAAEtD,KAAK,CAACmB,OAAO,CAACM,IAAI,CAAC;MACzD,IAAI,CAACF,YAAY,GAAG,KAAK;MAEzB,IAAI,CAACqC,gBAAgB,CAACX,IAAI,CAAC;IAC7B;EAAA;IAAAlB,GAAA;IAAAhB,KAAA,EAEA,SAAA8C,KAAKA,CAAA,EAAG;MACN,IAAI,CAACd,KAAK,GAAG;QAAEtC,IAAI,EAAE,EAAE;QAAEC,IAAI,EAAE;MAAG,CAAC;IACrC;EAAA;IAAAqB,GAAA;IAAAhB,KAAA,EAEA,SAAA+C,MAAMA,CAAA,EAAG;MACP,IAAI,CAACJ,YAAY,GAAG,CAAC;IACvB;EAAA;IAAA3B,GAAA;IAAAhB,KAAA,EAEA,SAAAW,MAAMA,CAACqC,WAAkB,EAAEC,QAAe,EAAE;MAC1C,IAAID,WAAW,CAACE,GAAG,CAACjB,MAAM,KAAK,CAAC,EAAE;MAClC,IAAI,CAACD,KAAK,CAACrC,IAAI,GAAG,EAAE;MACpB,IAAIwD,SAAS,GAAGH,WAAW,CAACR,MAAM,CAACS,QAAQ,CAAC;MAC5C,IAAIG,SAAS,GAAG,IAAI,CAAC9C,YAAY;MACjC,IAAM+C,SAAS,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;MAC5B;MACE;MACA,IAAI,CAACZ,YAAY,GAAG,IAAI,CAACtD,OAAO,CAACmE,KAAK,GAAGH,SAAS,IAClD,IAAI,CAACrB,KAAK,CAACtC,IAAI,CAACuC,MAAM,GAAG,CAAC,EAC1B;QACA,IAAMC,IAAI,GAAG,IAAI,CAACF,KAAK,CAACtC,IAAI,CAACyC,GAAG,CAAC,CAAC;QAClC,IAAID,IAAI,EAAE;UACRiB,SAAS,GAAGA,SAAS,CAACM,OAAO,CAACvB,IAAI,CAACK,KAAK,CAAC;UACzCa,SAAS,GAAGlB,IAAI,CAACQ,KAAK;QACxB;MACF,CAAC,MAAM;QACL,IAAI,CAACC,YAAY,GAAGU,SAAS;MAC/B;MACA,IAAIF,SAAS,CAAClB,MAAM,CAAC,CAAC,KAAK,CAAC,EAAE;MAC9B,IAAI,CAACD,KAAK,CAACtC,IAAI,CAAC+C,IAAI,CAAC;QAAEF,KAAK,EAAEY,SAAS;QAAET,KAAK,EAAEU;MAAU,CAAC,CAAC;MAC5D;MACA,IAAI,IAAI,CAACpB,KAAK,CAACtC,IAAI,CAACuC,MAAM,GAAG,IAAI,CAAC5C,OAAO,CAACqE,QAAQ,EAAE;QAClD,IAAI,CAAC1B,KAAK,CAACtC,IAAI,CAACiE,KAAK,CAAC,CAAC;MACzB;IACF;EAAA;IAAA3C,GAAA;IAAAhB,KAAA,EAEA,SAAAL,IAAIA,CAAA,EAAG;MACL,IAAI,CAACmC,MAAM,CAAC,MAAM,EAAE,MAAM,CAAC;IAC7B;EAAA;IAAAd,GAAA;IAAAhB,KAAA,EAEA,SAAAY,SAASA,CAAC2B,KAAY,EAAE;MACtBqB,cAAc,CAAC,IAAI,CAAC5B,KAAK,CAACtC,IAAI,EAAE6C,KAAK,CAAC;MACtCqB,cAAc,CAAC,IAAI,CAAC5B,KAAK,CAACrC,IAAI,EAAE4C,KAAK,CAAC;IACxC;EAAA;IAAAvB,GAAA;IAAAhB,KAAA,EAEA,SAAAN,IAAIA,CAAA,EAAG;MACL,IAAI,CAACoC,MAAM,CAAC,MAAM,EAAE,MAAM,CAAC;IAC7B;EAAA;IAAAd,GAAA;IAAAhB,KAAA,EAEU,SAAA6C,gBAAgBA,CAACgB,SAAoB,EAAE;MAC/C,IAAIA,SAAS,CAACnB,KAAK,EAAE;QACnB,IAAI,CAACtD,KAAK,CAAC0E,YAAY,CAACD,SAAS,CAACnB,KAAK,EAAEzD,KAAK,CAACmB,OAAO,CAACM,IAAI,CAAC;MAC9D,CAAC,MAAM;QACL,IAAMqD,KAAK,GAAGC,kBAAkB,CAAC,IAAI,CAAC5E,KAAK,CAAC6E,MAAM,EAAEJ,SAAS,CAACtB,KAAK,CAAC;QACpE,IAAI,CAACnD,KAAK,CAAC0E,YAAY,CAACC,KAAK,EAAE9E,KAAK,CAACmB,OAAO,CAACM,IAAI,CAAC;MACpD;IACF;EAAA;AAAA,EAtIoB1B,MAAM;AAAAS,eAAA,CAAtBP,OAAO,cACuB;EAChCsE,KAAK,EAAE,IAAI;EACXE,QAAQ,EAAE,GAAG;EACbjD,QAAQ,EAAE;AACZ,CAAC;AAoIH,SAASmD,cAAcA,CAAC5B,KAAkB,EAAEO,KAAY,EAAE;EACxD,IAAI2B,WAAW,GAAG3B,KAAK;EACvB,KAAK,IAAI4B,CAAC,GAAGnC,KAAK,CAACC,MAAM,GAAG,CAAC,EAAEkC,CAAC,IAAI,CAAC,EAAEA,CAAC,IAAI,CAAC,EAAE;IAC7C,IAAMC,OAAO,GAAGpC,KAAK,CAACmC,CAAC,CAAC;IACxBnC,KAAK,CAACmC,CAAC,CAAC,GAAG;MACT5B,KAAK,EAAE2B,WAAW,CAACtD,SAAS,CAACwD,OAAO,CAAC7B,KAAK,EAAE,IAAI,CAAC;MACjDG,KAAK,EAAE0B,OAAO,CAAC1B,KAAK,IAAI7B,cAAc,CAACuD,OAAO,CAAC1B,KAAK,EAAEwB,WAAW;IACnE,CAAC;IACDA,WAAW,GAAGE,OAAO,CAAC7B,KAAK,CAAC3B,SAAS,CAACsD,WAAW,CAAC;IAClD,IAAIlC,KAAK,CAACmC,CAAC,CAAC,CAAC5B,KAAK,CAACN,MAAM,CAAC,CAAC,KAAK,CAAC,EAAE;MACjCD,KAAK,CAACqC,MAAM,CAACF,CAAC,EAAE,CAAC,CAAC;IACpB;EACF;AACF;AAEA,SAASG,qBAAqBA,CAACL,MAAc,EAAE1B,KAAY,EAAE;EAC3D,IAAMgC,MAAM,GAAGhC,KAAK,CAACW,GAAG,CAACX,KAAK,CAACW,GAAG,CAACjB,MAAM,GAAG,CAAC,CAAC;EAC9C,IAAIsC,MAAM,IAAI,IAAI,EAAE,OAAO,KAAK;EAChC,IAAIA,MAAM,CAACC,MAAM,IAAI,IAAI,EAAE;IACzB,OAAO,OAAOD,MAAM,CAACC,MAAM,KAAK,QAAQ,IAAID,MAAM,CAACC,MAAM,CAACC,QAAQ,CAAC,IAAI,CAAC;EAC1E;EACA,IAAIF,MAAM,CAACG,UAAU,IAAI,IAAI,EAAE;IAC7B,OAAOC,MAAM,CAACC,IAAI,CAACL,MAAM,CAACG,UAAU,CAAC,CAACG,IAAI,CAAE,UAAAC,IAAI,EAAK;MACnD,OAAOb,MAAM,CAACc,KAAK,CAACD,IAAI,EAAE/F,KAAK,CAACiG,KAAK,CAAC,IAAI,IAAI;IAChD,CAAC,CAAC;EACJ;EACA,OAAO,KAAK;AACd;AAEA,SAAShB,kBAAkBA,CAACC,MAAc,EAAE1B,KAAY,EAAE;EACxD,IAAM0C,YAAY,GAAG1C,KAAK,CAAC2C,MAAM,CAAC,UAACjD,MAAM,EAAEkD,EAAE,EAAK;IAChD,OAAOlD,MAAM,IAAIkD,EAAE,UAAO,IAAI,CAAC,CAAC;EAClC,CAAC,EAAE,CAAC,CAAC;EACL,IAAIC,WAAW,GAAG7C,KAAK,CAACN,MAAM,CAAC,CAAC,GAAGgD,YAAY;EAC/C,IAAIX,qBAAqB,CAACL,MAAM,EAAE1B,KAAK,CAAC,EAAE;IACxC6C,WAAW,IAAI,CAAC;EAClB;EACA,OAAOA,WAAW;AACpB;AAEA,SAASvE,cAAcA,CAAC6B,KAAmB,EAAEH,KAAY,EAAE;EACzD,IAAI,CAACG,KAAK,EAAE,OAAOA,KAAK;EACxB,IAAM2C,KAAK,GAAG9C,KAAK,CAAC+C,iBAAiB,CAAC5C,KAAK,CAACqB,KAAK,CAAC;EAClD,IAAMwB,GAAG,GAAGhD,KAAK,CAAC+C,iBAAiB,CAAC5C,KAAK,CAACqB,KAAK,GAAGrB,KAAK,CAACT,MAAM,CAAC;EAC/D,OAAO;IAAE8B,KAAK,EAAEsB,KAAK;IAAEpD,MAAM,EAAEsD,GAAG,GAAGF;EAAM,CAAC;AAC9C;AAEA,SAASnG,OAAO,IAAIsG,OAAO,EAAExB,kBAAkB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}