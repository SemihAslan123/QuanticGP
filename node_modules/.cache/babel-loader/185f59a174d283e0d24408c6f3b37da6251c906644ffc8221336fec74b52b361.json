{"ast":null,"code":"import \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.array.from.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.constructor.js\";\nimport \"core-js/modules/es.regexp.dot-all.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.sticky.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/es.string.match.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nvar ignoreRegexp = /\\bmso-list:[^;]*ignore/i;\nvar idRegexp = /\\bmso-list:[^;]*\\bl(\\d+)/i;\nvar indentRegexp = /\\bmso-list:[^;]*\\blevel(\\d+)/i;\nvar parseListItem = function parseListItem(element, html) {\n  var style = element.getAttribute('style');\n  var idMatch = style === null || style === void 0 ? void 0 : style.match(idRegexp);\n  if (!idMatch) {\n    return null;\n  }\n  var id = Number(idMatch[1]);\n  var indentMatch = style === null || style === void 0 ? void 0 : style.match(indentRegexp);\n  var indent = indentMatch ? Number(indentMatch[1]) : 1;\n  var typeRegexp = new RegExp(\"@list l\".concat(id, \":level\").concat(indent, \"\\\\s*\\\\{[^\\\\}]*mso-level-number-format:\\\\s*([\\\\w-]+)\"), 'i');\n  var typeMatch = html.match(typeRegexp);\n  var type = typeMatch && typeMatch[1] === 'bullet' ? 'bullet' : 'ordered';\n  return {\n    id: id,\n    indent: indent,\n    type: type,\n    element: element\n  };\n};\n\n// list items are represented as `p` tags with styles like `mso-list: l0 level1` where:\n// 1. \"0\" in \"l0\" means the list item id;\n// 2. \"1\" in \"level1\" means the indent level, starting from 1.\nvar normalizeListItem = function normalizeListItem(doc) {\n  var msoList = Array.from(doc.querySelectorAll('[style*=mso-list]'));\n  var ignored = [];\n  var others = [];\n  msoList.forEach(function (node) {\n    var shouldIgnore = (node.getAttribute('style') || '').match(ignoreRegexp);\n    if (shouldIgnore) {\n      ignored.push(node);\n    } else {\n      others.push(node);\n    }\n  });\n\n  // Each list item contains a marker wrapped with \"mso-list: Ignore\".\n  ignored.forEach(function (node) {\n    var _node$parentNode;\n    return (_node$parentNode = node.parentNode) === null || _node$parentNode === void 0 ? void 0 : _node$parentNode.removeChild(node);\n  });\n\n  // The list stype is not defined inline with the tag, instead, it's in the\n  // style tag so we need to pass the html as a string.\n  var html = doc.documentElement.innerHTML;\n  var listItems = others.map(function (element) {\n    return parseListItem(element, html);\n  }).filter(function (parsed) {\n    return parsed;\n  });\n  var _loop = function _loop() {\n    var _childListItems$;\n    var childListItems = [];\n    var current = listItems.shift();\n    // Group continuous items into the same group (aka \"ul\")\n    while (current) {\n      var _listItems$;\n      childListItems.push(current);\n      current = listItems.length && ((_listItems$ = listItems[0]) === null || _listItems$ === void 0 ? void 0 : _listItems$.element) === current.element.nextElementSibling &&\n      // Different id means the next item doesn't belong to this group.\n      listItems[0].id === current.id ? listItems.shift() : null;\n    }\n    var ul = document.createElement('ul');\n    childListItems.forEach(function (listItem) {\n      var li = document.createElement('li');\n      li.setAttribute('data-list', listItem.type);\n      if (listItem.indent > 1) {\n        li.setAttribute('class', \"ql-indent-\".concat(listItem.indent - 1));\n      }\n      li.innerHTML = listItem.element.innerHTML;\n      ul.appendChild(li);\n    });\n    var element = (_childListItems$ = childListItems[0]) === null || _childListItems$ === void 0 ? void 0 : _childListItems$.element;\n    var _ref2 = element !== null && element !== void 0 ? element : {},\n      parentNode = _ref2.parentNode;\n    if (element) {\n      parentNode === null || parentNode === void 0 || parentNode.replaceChild(ul, element);\n    }\n    childListItems.slice(1).forEach(function (_ref) {\n      var e = _ref.element;\n      parentNode === null || parentNode === void 0 || parentNode.removeChild(e);\n    });\n  };\n  while (listItems.length) {\n    _loop();\n  }\n};\nexport default function normalize(doc) {\n  if (doc.documentElement.getAttribute('xmlns:w') === 'urn:schemas-microsoft-com:office:word') {\n    normalizeListItem(doc);\n  }\n}","map":{"version":3,"names":["ignoreRegexp","idRegexp","indentRegexp","parseListItem","element","html","style","getAttribute","idMatch","match","id","Number","indentMatch","indent","typeRegexp","RegExp","concat","typeMatch","type","normalizeListItem","doc","msoList","Array","from","querySelectorAll","ignored","others","forEach","node","shouldIgnore","push","_node$parentNode","parentNode","removeChild","documentElement","innerHTML","listItems","map","filter","parsed","_loop","_childListItems$","childListItems","current","shift","_listItems$","length","nextElementSibling","ul","document","createElement","listItem","li","setAttribute","appendChild","_ref2","replaceChild","slice","_ref","e","normalize"],"sources":["../../../../src/modules/normalizeExternalHTML/normalizers/msWord.ts"],"sourcesContent":["const ignoreRegexp = /\\bmso-list:[^;]*ignore/i;\nconst idRegexp = /\\bmso-list:[^;]*\\bl(\\d+)/i;\nconst indentRegexp = /\\bmso-list:[^;]*\\blevel(\\d+)/i;\n\nconst parseListItem = (element: Element, html: string) => {\n  const style = element.getAttribute('style');\n  const idMatch = style?.match(idRegexp);\n  if (!idMatch) {\n    return null;\n  }\n  const id = Number(idMatch[1]);\n\n  const indentMatch = style?.match(indentRegexp);\n  const indent = indentMatch ? Number(indentMatch[1]) : 1;\n\n  const typeRegexp = new RegExp(\n    `@list l${id}:level${indent}\\\\s*\\\\{[^\\\\}]*mso-level-number-format:\\\\s*([\\\\w-]+)`,\n    'i',\n  );\n  const typeMatch = html.match(typeRegexp);\n  const type = typeMatch && typeMatch[1] === 'bullet' ? 'bullet' : 'ordered';\n\n  return { id, indent, type, element };\n};\n\n// list items are represented as `p` tags with styles like `mso-list: l0 level1` where:\n// 1. \"0\" in \"l0\" means the list item id;\n// 2. \"1\" in \"level1\" means the indent level, starting from 1.\nconst normalizeListItem = (doc: Document) => {\n  const msoList = Array.from(doc.querySelectorAll('[style*=mso-list]'));\n  const ignored: Element[] = [];\n  const others: Element[] = [];\n  msoList.forEach((node) => {\n    const shouldIgnore = (node.getAttribute('style') || '').match(ignoreRegexp);\n    if (shouldIgnore) {\n      ignored.push(node);\n    } else {\n      others.push(node);\n    }\n  });\n\n  // Each list item contains a marker wrapped with \"mso-list: Ignore\".\n  ignored.forEach((node) => node.parentNode?.removeChild(node));\n\n  // The list stype is not defined inline with the tag, instead, it's in the\n  // style tag so we need to pass the html as a string.\n  const html = doc.documentElement.innerHTML;\n  const listItems = others\n    .map((element) => parseListItem(element, html))\n    .filter((parsed) => parsed);\n\n  while (listItems.length) {\n    const childListItems = [];\n\n    let current = listItems.shift();\n    // Group continuous items into the same group (aka \"ul\")\n    while (current) {\n      childListItems.push(current);\n      current =\n        listItems.length &&\n        listItems[0]?.element === current.element.nextElementSibling &&\n        // Different id means the next item doesn't belong to this group.\n        listItems[0].id === current.id\n          ? listItems.shift()\n          : null;\n    }\n\n    const ul = document.createElement('ul');\n    childListItems.forEach((listItem) => {\n      const li = document.createElement('li');\n      li.setAttribute('data-list', listItem.type);\n      if (listItem.indent > 1) {\n        li.setAttribute('class', `ql-indent-${listItem.indent - 1}`);\n      }\n      li.innerHTML = listItem.element.innerHTML;\n      ul.appendChild(li);\n    });\n\n    const element = childListItems[0]?.element;\n    const { parentNode } = element ?? {};\n    if (element) {\n      parentNode?.replaceChild(ul, element);\n    }\n    childListItems.slice(1).forEach(({ element: e }) => {\n      parentNode?.removeChild(e);\n    });\n  }\n};\n\nexport default function normalize(doc: Document) {\n  if (\n    doc.documentElement.getAttribute('xmlns:w') ===\n    'urn:schemas-microsoft-com:office:word'\n  ) {\n    normalizeListItem(doc);\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}