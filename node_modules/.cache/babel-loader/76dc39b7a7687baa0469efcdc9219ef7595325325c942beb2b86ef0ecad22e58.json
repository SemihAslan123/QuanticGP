{"ast":null,"code":"import _classCallCheck from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _callSuper from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/callSuper.js\";\nimport _superPropGet from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/superPropGet.js\";\nimport _inherits from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.array.from.js\";\nimport \"core-js/modules/es.array.join.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/es.string.split.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { EmbedBlot } from 'parchment';\nimport TextBlot from './text.js';\nvar GUARD_TEXT = \"\\uFEFF\";\nvar Embed = /*#__PURE__*/function (_EmbedBlot) {\n  function Embed(scroll, node) {\n    var _this;\n    _classCallCheck(this, Embed);\n    _this = _callSuper(this, Embed, [scroll, node]);\n    _this.contentNode = document.createElement('span');\n    _this.contentNode.setAttribute('contenteditable', 'false');\n    Array.from(_this.domNode.childNodes).forEach(function (childNode) {\n      _this.contentNode.appendChild(childNode);\n    });\n    _this.leftGuard = document.createTextNode(GUARD_TEXT);\n    _this.rightGuard = document.createTextNode(GUARD_TEXT);\n    _this.domNode.appendChild(_this.leftGuard);\n    _this.domNode.appendChild(_this.contentNode);\n    _this.domNode.appendChild(_this.rightGuard);\n    return _this;\n  }\n  _inherits(Embed, _EmbedBlot);\n  return _createClass(Embed, [{\n    key: \"index\",\n    value: function index(node, offset) {\n      if (node === this.leftGuard) return 0;\n      if (node === this.rightGuard) return 1;\n      return _superPropGet(Embed, \"index\", this, 3)([node, offset]);\n    }\n  }, {\n    key: \"restore\",\n    value: function restore(node) {\n      var range = null;\n      var textNode;\n      var text = node.data.split(GUARD_TEXT).join('');\n      if (node === this.leftGuard) {\n        if (this.prev instanceof TextBlot) {\n          var prevLength = this.prev.length();\n          this.prev.insertAt(prevLength, text);\n          range = {\n            startNode: this.prev.domNode,\n            startOffset: prevLength + text.length\n          };\n        } else {\n          textNode = document.createTextNode(text);\n          this.parent.insertBefore(this.scroll.create(textNode), this);\n          range = {\n            startNode: textNode,\n            startOffset: text.length\n          };\n        }\n      } else if (node === this.rightGuard) {\n        if (this.next instanceof TextBlot) {\n          this.next.insertAt(0, text);\n          range = {\n            startNode: this.next.domNode,\n            startOffset: text.length\n          };\n        } else {\n          textNode = document.createTextNode(text);\n          this.parent.insertBefore(this.scroll.create(textNode), this.next);\n          range = {\n            startNode: textNode,\n            startOffset: text.length\n          };\n        }\n      }\n      node.data = GUARD_TEXT;\n      return range;\n    }\n  }, {\n    key: \"update\",\n    value: function update(mutations, context) {\n      var _this2 = this;\n      mutations.forEach(function (mutation) {\n        if (mutation.type === 'characterData' && (mutation.target === _this2.leftGuard || mutation.target === _this2.rightGuard)) {\n          var range = _this2.restore(mutation.target);\n          if (range) context.range = range;\n        }\n      });\n    }\n  }]);\n}(EmbedBlot);\nexport default Embed;","map":{"version":3,"names":["EmbedBlot","TextBlot","GUARD_TEXT","Embed","_EmbedBlot","scroll","node","_this","_classCallCheck","_callSuper","contentNode","document","createElement","setAttribute","Array","from","domNode","childNodes","forEach","childNode","appendChild","leftGuard","createTextNode","rightGuard","_inherits","_createClass","key","value","index","offset","_superPropGet","restore","range","textNode","text","data","split","join","prev","prevLength","length","insertAt","startNode","startOffset","parent","insertBefore","create","next","update","mutations","context","_this2","mutation","type","target"],"sources":["../../src/blots/embed.ts"],"sourcesContent":["import type { ScrollBlot } from 'parchment';\nimport { EmbedBlot } from 'parchment';\nimport TextBlot from './text.js';\n\nconst GUARD_TEXT = '\\uFEFF';\n\nexport interface EmbedContextRange {\n  startNode: Node | Text;\n  startOffset: number;\n  endNode?: Node | Text;\n  endOffset?: number;\n}\n\nclass Embed extends EmbedBlot {\n  contentNode: HTMLSpanElement;\n  leftGuard: Text;\n  rightGuard: Text;\n\n  constructor(scroll: ScrollBlot, node: Node) {\n    super(scroll, node);\n    this.contentNode = document.createElement('span');\n    this.contentNode.setAttribute('contenteditable', 'false');\n    Array.from(this.domNode.childNodes).forEach((childNode) => {\n      this.contentNode.appendChild(childNode);\n    });\n    this.leftGuard = document.createTextNode(GUARD_TEXT);\n    this.rightGuard = document.createTextNode(GUARD_TEXT);\n    this.domNode.appendChild(this.leftGuard);\n    this.domNode.appendChild(this.contentNode);\n    this.domNode.appendChild(this.rightGuard);\n  }\n\n  index(node: Node, offset: number) {\n    if (node === this.leftGuard) return 0;\n    if (node === this.rightGuard) return 1;\n    return super.index(node, offset);\n  }\n\n  restore(node: Text): EmbedContextRange | null {\n    let range: EmbedContextRange | null = null;\n    let textNode: Text;\n    const text = node.data.split(GUARD_TEXT).join('');\n    if (node === this.leftGuard) {\n      if (this.prev instanceof TextBlot) {\n        const prevLength = this.prev.length();\n        this.prev.insertAt(prevLength, text);\n        range = {\n          startNode: this.prev.domNode,\n          startOffset: prevLength + text.length,\n        };\n      } else {\n        textNode = document.createTextNode(text);\n        this.parent.insertBefore(this.scroll.create(textNode), this);\n        range = {\n          startNode: textNode,\n          startOffset: text.length,\n        };\n      }\n    } else if (node === this.rightGuard) {\n      if (this.next instanceof TextBlot) {\n        this.next.insertAt(0, text);\n        range = {\n          startNode: this.next.domNode,\n          startOffset: text.length,\n        };\n      } else {\n        textNode = document.createTextNode(text);\n        this.parent.insertBefore(this.scroll.create(textNode), this.next);\n        range = {\n          startNode: textNode,\n          startOffset: text.length,\n        };\n      }\n    }\n    node.data = GUARD_TEXT;\n    return range;\n  }\n\n  update(mutations: MutationRecord[], context: Record<string, unknown>) {\n    mutations.forEach((mutation) => {\n      if (\n        mutation.type === 'characterData' &&\n        (mutation.target === this.leftGuard ||\n          mutation.target === this.rightGuard)\n      ) {\n        const range = this.restore(mutation.target as Text);\n        if (range) context.range = range;\n      }\n    });\n  }\n}\n\nexport default Embed;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}