{"ast":null,"code":"import _classCallCheck from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _callSuper from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/callSuper.js\";\nimport _superPropGet from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/superPropGet.js\";\nimport _inherits from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _defineProperty from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport \"core-js/modules/es.array.join.js\";\nimport \"core-js/modules/web.timers.js\";\nimport { merge } from 'lodash-es';\nimport Emitter from '../core/emitter.js';\nimport BaseTheme, { BaseTooltip } from './base.js';\nimport { Range } from '../core/selection.js';\nimport icons from '../ui/icons.js';\nimport Quill from '../core/quill.js';\nvar TOOLBAR_CONFIG = [['bold', 'italic', 'link'], [{\n  header: 1\n}, {\n  header: 2\n}, 'blockquote']];\nvar BubbleTooltip = /*#__PURE__*/function (_BaseTooltip) {\n  function BubbleTooltip(quill, bounds) {\n    var _this;\n    _classCallCheck(this, BubbleTooltip);\n    _this = _callSuper(this, BubbleTooltip, [quill, bounds]);\n    _this.quill.on(Emitter.events.EDITOR_CHANGE, function (type, range, oldRange, source) {\n      if (type !== Emitter.events.SELECTION_CHANGE) return;\n      if (range != null && range.length > 0 && source === Emitter.sources.USER) {\n        _this.show();\n        // Lock our width so we will expand beyond our offsetParent boundaries\n        _this.root.style.left = '0px';\n        _this.root.style.width = '';\n        _this.root.style.width = \"\".concat(_this.root.offsetWidth, \"px\");\n        var lines = _this.quill.getLines(range.index, range.length);\n        if (lines.length === 1) {\n          var _bounds = _this.quill.getBounds(range);\n          if (_bounds != null) {\n            _this.position(_bounds);\n          }\n        } else {\n          var lastLine = lines[lines.length - 1];\n          var index = _this.quill.getIndex(lastLine);\n          var length = Math.min(lastLine.length() - 1, range.index + range.length - index);\n          var indexBounds = _this.quill.getBounds(new Range(index, length));\n          if (indexBounds != null) {\n            _this.position(indexBounds);\n          }\n        }\n      } else if (document.activeElement !== _this.textbox && _this.quill.hasFocus()) {\n        _this.hide();\n      }\n    });\n    return _this;\n  }\n  _inherits(BubbleTooltip, _BaseTooltip);\n  return _createClass(BubbleTooltip, [{\n    key: \"listen\",\n    value: function listen() {\n      var _this2 = this;\n      _superPropGet(BubbleTooltip, \"listen\", this, 3)([]);\n      // @ts-expect-error Fix me later\n      this.root.querySelector('.ql-close').addEventListener('click', function () {\n        _this2.root.classList.remove('ql-editing');\n      });\n      this.quill.on(Emitter.events.SCROLL_OPTIMIZE, function () {\n        // Let selection be restored by toolbar handlers before repositioning\n        setTimeout(function () {\n          if (_this2.root.classList.contains('ql-hidden')) return;\n          var range = _this2.quill.getSelection();\n          if (range != null) {\n            var bounds = _this2.quill.getBounds(range);\n            if (bounds != null) {\n              _this2.position(bounds);\n            }\n          }\n        }, 1);\n      });\n    }\n  }, {\n    key: \"cancel\",\n    value: function cancel() {\n      this.show();\n    }\n  }, {\n    key: \"position\",\n    value: function position(reference) {\n      var shift = _superPropGet(BubbleTooltip, \"position\", this, 3)([reference]);\n      var arrow = this.root.querySelector('.ql-tooltip-arrow');\n      // @ts-expect-error\n      arrow.style.marginLeft = '';\n      if (shift !== 0) {\n        // @ts-expect-error\n        arrow.style.marginLeft = \"\".concat(-1 * shift - arrow.offsetWidth / 2, \"px\");\n      }\n      return shift;\n    }\n  }]);\n}(BaseTooltip);\n_defineProperty(BubbleTooltip, \"TEMPLATE\", ['<span class=\"ql-tooltip-arrow\"></span>', '<div class=\"ql-tooltip-editor\">', '<input type=\"text\" data-formula=\"e=mc^2\" data-link=\"https://quilljs.com\" data-video=\"Embed URL\">', '<a class=\"ql-close\"></a>', '</div>'].join(''));\nvar BubbleTheme = /*#__PURE__*/function (_BaseTheme) {\n  function BubbleTheme(quill, options) {\n    var _this3;\n    _classCallCheck(this, BubbleTheme);\n    if (options.modules.toolbar != null && options.modules.toolbar.container == null) {\n      options.modules.toolbar.container = TOOLBAR_CONFIG;\n    }\n    _this3 = _callSuper(this, BubbleTheme, [quill, options]);\n    _this3.quill.container.classList.add('ql-bubble');\n    return _this3;\n  }\n  _inherits(BubbleTheme, _BaseTheme);\n  return _createClass(BubbleTheme, [{\n    key: \"extendToolbar\",\n    value: function extendToolbar(toolbar) {\n      // @ts-expect-error\n      this.tooltip = new BubbleTooltip(this.quill, this.options.bounds);\n      if (toolbar.container != null) {\n        this.tooltip.root.appendChild(toolbar.container);\n        this.buildButtons(toolbar.container.querySelectorAll('button'), icons);\n        this.buildPickers(toolbar.container.querySelectorAll('select'), icons);\n      }\n    }\n  }]);\n}(BaseTheme);\nBubbleTheme.DEFAULTS = merge({}, BaseTheme.DEFAULTS, {\n  modules: {\n    toolbar: {\n      handlers: {\n        link: function link(value) {\n          if (!value) {\n            this.quill.format('link', false, Quill.sources.USER);\n          } else {\n            // @ts-expect-error\n            this.quill.theme.tooltip.edit();\n          }\n        }\n      }\n    }\n  }\n});\nexport { BubbleTooltip, BubbleTheme as default };","map":{"version":3,"names":["merge","Emitter","BaseTheme","BaseTooltip","Range","icons","Quill","TOOLBAR_CONFIG","header","BubbleTooltip","_BaseTooltip","quill","bounds","_this","_classCallCheck","_callSuper","on","events","EDITOR_CHANGE","type","range","oldRange","source","SELECTION_CHANGE","length","sources","USER","show","root","style","left","width","concat","offsetWidth","lines","getLines","index","getBounds","position","lastLine","getIndex","Math","min","indexBounds","document","activeElement","textbox","hasFocus","hide","_inherits","_createClass","key","value","listen","_this2","_superPropGet","querySelector","addEventListener","classList","remove","SCROLL_OPTIMIZE","setTimeout","contains","getSelection","cancel","reference","shift","arrow","marginLeft","_defineProperty","join","BubbleTheme","_BaseTheme","options","_this3","modules","toolbar","container","add","extendToolbar","tooltip","appendChild","buildButtons","querySelectorAll","buildPickers","DEFAULTS","handlers","link","format","theme","edit","default"],"sources":["../../src/themes/bubble.ts"],"sourcesContent":["import { merge } from 'lodash-es';\nimport Emitter from '../core/emitter.js';\nimport BaseTheme, { BaseTooltip } from './base.js';\nimport { Range } from '../core/selection.js';\nimport type { Bounds } from '../core/selection.js';\nimport icons from '../ui/icons.js';\nimport Quill from '../core/quill.js';\nimport type { ThemeOptions } from '../core/theme.js';\nimport type Toolbar from '../modules/toolbar.js';\nimport type { ToolbarConfig } from '../modules/toolbar.js';\n\nconst TOOLBAR_CONFIG: ToolbarConfig = [\n  ['bold', 'italic', 'link'],\n  [{ header: 1 }, { header: 2 }, 'blockquote'],\n];\n\nclass BubbleTooltip extends BaseTooltip {\n  static TEMPLATE = [\n    '<span class=\"ql-tooltip-arrow\"></span>',\n    '<div class=\"ql-tooltip-editor\">',\n    '<input type=\"text\" data-formula=\"e=mc^2\" data-link=\"https://quilljs.com\" data-video=\"Embed URL\">',\n    '<a class=\"ql-close\"></a>',\n    '</div>',\n  ].join('');\n\n  constructor(quill: Quill, bounds?: HTMLElement) {\n    super(quill, bounds);\n    this.quill.on(\n      Emitter.events.EDITOR_CHANGE,\n      (type, range, oldRange, source) => {\n        if (type !== Emitter.events.SELECTION_CHANGE) return;\n        if (\n          range != null &&\n          range.length > 0 &&\n          source === Emitter.sources.USER\n        ) {\n          this.show();\n          // Lock our width so we will expand beyond our offsetParent boundaries\n          this.root.style.left = '0px';\n          this.root.style.width = '';\n          this.root.style.width = `${this.root.offsetWidth}px`;\n          const lines = this.quill.getLines(range.index, range.length);\n          if (lines.length === 1) {\n            const bounds = this.quill.getBounds(range);\n            if (bounds != null) {\n              this.position(bounds);\n            }\n          } else {\n            const lastLine = lines[lines.length - 1];\n            const index = this.quill.getIndex(lastLine);\n            const length = Math.min(\n              lastLine.length() - 1,\n              range.index + range.length - index,\n            );\n            const indexBounds = this.quill.getBounds(new Range(index, length));\n            if (indexBounds != null) {\n              this.position(indexBounds);\n            }\n          }\n        } else if (\n          document.activeElement !== this.textbox &&\n          this.quill.hasFocus()\n        ) {\n          this.hide();\n        }\n      },\n    );\n  }\n\n  listen() {\n    super.listen();\n    // @ts-expect-error Fix me later\n    this.root.querySelector('.ql-close').addEventListener('click', () => {\n      this.root.classList.remove('ql-editing');\n    });\n    this.quill.on(Emitter.events.SCROLL_OPTIMIZE, () => {\n      // Let selection be restored by toolbar handlers before repositioning\n      setTimeout(() => {\n        if (this.root.classList.contains('ql-hidden')) return;\n        const range = this.quill.getSelection();\n        if (range != null) {\n          const bounds = this.quill.getBounds(range);\n          if (bounds != null) {\n            this.position(bounds);\n          }\n        }\n      }, 1);\n    });\n  }\n\n  cancel() {\n    this.show();\n  }\n\n  position(reference: Bounds) {\n    const shift = super.position(reference);\n    const arrow = this.root.querySelector('.ql-tooltip-arrow');\n    // @ts-expect-error\n    arrow.style.marginLeft = '';\n    if (shift !== 0) {\n      // @ts-expect-error\n      arrow.style.marginLeft = `${-1 * shift - arrow.offsetWidth / 2}px`;\n    }\n    return shift;\n  }\n}\n\nclass BubbleTheme extends BaseTheme {\n  tooltip: BubbleTooltip;\n\n  constructor(quill: Quill, options: ThemeOptions) {\n    if (\n      options.modules.toolbar != null &&\n      options.modules.toolbar.container == null\n    ) {\n      options.modules.toolbar.container = TOOLBAR_CONFIG;\n    }\n    super(quill, options);\n    this.quill.container.classList.add('ql-bubble');\n  }\n\n  extendToolbar(toolbar: Toolbar) {\n    // @ts-expect-error\n    this.tooltip = new BubbleTooltip(this.quill, this.options.bounds);\n    if (toolbar.container != null) {\n      this.tooltip.root.appendChild<HTMLElement>(toolbar.container);\n      this.buildButtons(toolbar.container.querySelectorAll('button'), icons);\n      this.buildPickers(toolbar.container.querySelectorAll('select'), icons);\n    }\n  }\n}\nBubbleTheme.DEFAULTS = merge({}, BaseTheme.DEFAULTS, {\n  modules: {\n    toolbar: {\n      handlers: {\n        link(value: string) {\n          if (!value) {\n            this.quill.format('link', false, Quill.sources.USER);\n          } else {\n            // @ts-expect-error\n            this.quill.theme.tooltip.edit();\n          }\n        },\n      },\n    },\n  },\n} satisfies ThemeOptions);\n\nexport { BubbleTooltip, BubbleTheme as default };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}