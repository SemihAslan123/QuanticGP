{"ast":null,"code":"import _classCallCheck from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _defineProperty from \"/home/esteban/2emeAnnee/S3/devWeb/QuanticGP10/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.find.js\";\nimport \"core-js/modules/web.queue-microtask.js\";\nimport Embed from '../blots/embed.js';\nimport Emitter from './emitter.js';\nvar Composition = /*#__PURE__*/function () {\n  function Composition(scroll, emitter) {\n    _classCallCheck(this, Composition);\n    _defineProperty(this, \"isComposing\", false);\n    this.scroll = scroll;\n    this.emitter = emitter;\n    this.setupListeners();\n  }\n  return _createClass(Composition, [{\n    key: \"setupListeners\",\n    value: function setupListeners() {\n      var _this = this;\n      this.scroll.domNode.addEventListener('compositionstart', function (event) {\n        if (!_this.isComposing) {\n          _this.handleCompositionStart(event);\n        }\n      });\n      this.scroll.domNode.addEventListener('compositionend', function (event) {\n        if (_this.isComposing) {\n          // Webkit makes DOM changes after compositionend, so we use microtask to\n          // ensure the order.\n          // https://bugs.webkit.org/show_bug.cgi?id=31902\n          queueMicrotask(function () {\n            _this.handleCompositionEnd(event);\n          });\n        }\n      });\n    }\n  }, {\n    key: \"handleCompositionStart\",\n    value: function handleCompositionStart(event) {\n      var blot = event.target instanceof Node ? this.scroll.find(event.target, true) : null;\n      if (blot && !(blot instanceof Embed)) {\n        this.emitter.emit(Emitter.events.COMPOSITION_BEFORE_START, event);\n        this.scroll.batchStart();\n        this.emitter.emit(Emitter.events.COMPOSITION_START, event);\n        this.isComposing = true;\n      }\n    }\n  }, {\n    key: \"handleCompositionEnd\",\n    value: function handleCompositionEnd(event) {\n      this.emitter.emit(Emitter.events.COMPOSITION_BEFORE_END, event);\n      this.scroll.batchEnd();\n      this.emitter.emit(Emitter.events.COMPOSITION_END, event);\n      this.isComposing = false;\n    }\n  }]);\n}();\nexport default Composition;","map":{"version":3,"names":["Embed","Emitter","Composition","scroll","emitter","_classCallCheck","_defineProperty","setupListeners","_createClass","key","value","_this","domNode","addEventListener","event","isComposing","handleCompositionStart","queueMicrotask","handleCompositionEnd","blot","target","Node","find","emit","events","COMPOSITION_BEFORE_START","batchStart","COMPOSITION_START","COMPOSITION_BEFORE_END","batchEnd","COMPOSITION_END"],"sources":["../../src/core/composition.ts"],"sourcesContent":["import Embed from '../blots/embed.js';\nimport type Scroll from '../blots/scroll.js';\nimport Emitter from './emitter.js';\n\nclass Composition {\n  isComposing = false;\n\n  constructor(\n    private scroll: Scroll,\n    private emitter: Emitter,\n  ) {\n    this.setupListeners();\n  }\n\n  private setupListeners() {\n    this.scroll.domNode.addEventListener('compositionstart', (event) => {\n      if (!this.isComposing) {\n        this.handleCompositionStart(event);\n      }\n    });\n\n    this.scroll.domNode.addEventListener('compositionend', (event) => {\n      if (this.isComposing) {\n        // Webkit makes DOM changes after compositionend, so we use microtask to\n        // ensure the order.\n        // https://bugs.webkit.org/show_bug.cgi?id=31902\n        queueMicrotask(() => {\n          this.handleCompositionEnd(event);\n        });\n      }\n    });\n  }\n\n  private handleCompositionStart(event: CompositionEvent) {\n    const blot =\n      event.target instanceof Node\n        ? this.scroll.find(event.target, true)\n        : null;\n\n    if (blot && !(blot instanceof Embed)) {\n      this.emitter.emit(Emitter.events.COMPOSITION_BEFORE_START, event);\n      this.scroll.batchStart();\n      this.emitter.emit(Emitter.events.COMPOSITION_START, event);\n      this.isComposing = true;\n    }\n  }\n\n  private handleCompositionEnd(event: CompositionEvent) {\n    this.emitter.emit(Emitter.events.COMPOSITION_BEFORE_END, event);\n    this.scroll.batchEnd();\n    this.emitter.emit(Emitter.events.COMPOSITION_END, event);\n    this.isComposing = false;\n  }\n}\n\nexport default Composition;\n"],"mappings":";;;;;;;;AAAA,OAAOA,KAAK,MAAM,mBAAmB;AAErC,OAAOC,OAAO,MAAM,cAAc;AAAA,IAE5BC,WAAW;EAGf,SAAAA,YACUC,MAAc,EACdC,OAAgB,EACxB;IAAAC,eAAA,OAAAH,WAAA;IAAAI,eAAA,sBALY,KAAK;IAKjB,KAFQH,MAAc,GAAdA,MAAc;IAAA,KACdC,OAAgB,GAAhBA,OAAgB;IAExB,IAAI,CAACG,cAAc,CAAC,CAAC;EACvB;EAAA,OAAAC,YAAA,CAAAN,WAAA;IAAAO,GAAA;IAAAC,KAAA,EAEQ,SAAAH,cAAcA,CAAA,EAAG;MAAA,IAAAI,KAAA;MACvB,IAAI,CAACR,MAAM,CAACS,OAAO,CAACC,gBAAgB,CAAC,kBAAkB,EAAG,UAAAC,KAAK,EAAK;QAClE,IAAI,CAACH,KAAI,CAACI,WAAW,EAAE;UACrBJ,KAAI,CAACK,sBAAsB,CAACF,KAAK,CAAC;QACpC;MACF,CAAC,CAAC;MAEF,IAAI,CAACX,MAAM,CAACS,OAAO,CAACC,gBAAgB,CAAC,gBAAgB,EAAG,UAAAC,KAAK,EAAK;QAChE,IAAIH,KAAI,CAACI,WAAW,EAAE;UACpB;UACA;UACA;UACAE,cAAc,CAAC,YAAM;YACnBN,KAAI,CAACO,oBAAoB,CAACJ,KAAK,CAAC;UAClC,CAAC,CAAC;QACJ;MACF,CAAC,CAAC;IACJ;EAAA;IAAAL,GAAA;IAAAC,KAAA,EAEQ,SAAAM,sBAAsBA,CAACF,KAAuB,EAAE;MACtD,IAAMK,IAAI,GACRL,KAAK,CAACM,MAAM,YAAYC,IAAI,GACxB,IAAI,CAAClB,MAAM,CAACmB,IAAI,CAACR,KAAK,CAACM,MAAM,EAAE,IAAI,CAAC,GACpC,IAAI;MAEV,IAAID,IAAI,IAAI,EAAEA,IAAI,YAAYnB,KAAK,CAAC,EAAE;QACpC,IAAI,CAACI,OAAO,CAACmB,IAAI,CAACtB,OAAO,CAACuB,MAAM,CAACC,wBAAwB,EAAEX,KAAK,CAAC;QACjE,IAAI,CAACX,MAAM,CAACuB,UAAU,CAAC,CAAC;QACxB,IAAI,CAACtB,OAAO,CAACmB,IAAI,CAACtB,OAAO,CAACuB,MAAM,CAACG,iBAAiB,EAAEb,KAAK,CAAC;QAC1D,IAAI,CAACC,WAAW,GAAG,IAAI;MACzB;IACF;EAAA;IAAAN,GAAA;IAAAC,KAAA,EAEQ,SAAAQ,oBAAoBA,CAACJ,KAAuB,EAAE;MACpD,IAAI,CAACV,OAAO,CAACmB,IAAI,CAACtB,OAAO,CAACuB,MAAM,CAACI,sBAAsB,EAAEd,KAAK,CAAC;MAC/D,IAAI,CAACX,MAAM,CAAC0B,QAAQ,CAAC,CAAC;MACtB,IAAI,CAACzB,OAAO,CAACmB,IAAI,CAACtB,OAAO,CAACuB,MAAM,CAACM,eAAe,EAAEhB,KAAK,CAAC;MACxD,IAAI,CAACC,WAAW,GAAG,KAAK;IAC1B;EAAA;AAAA;AAGF,eAAeb,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}